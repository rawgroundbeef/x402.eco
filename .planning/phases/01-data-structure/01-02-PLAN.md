---
phase: 01-data-structure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - lib/ecosystem.ts
autonomous: true

must_haves:
  truths:
    - "Data loader can read all JSON files from a category directory"
    - "Data loader returns typed EcosystemEntry arrays"
    - "Build-time data loading works with Next.js static generation"
  artifacts:
    - path: "lib/ecosystem.ts"
      provides: "Functions to load ecosystem entries from JSON files"
      exports: ["getEcosystemEntries", "getEntriesByCategory", "getAllEntries"]
  key_links:
    - from: "lib/ecosystem.ts"
      to: "lib/types/ecosystem.ts"
      via: "imports types"
      pattern: "import.*from.*types/ecosystem"
    - from: "lib/ecosystem.ts"
      to: "data/ecosystem/**/*.json"
      via: "fs.readFileSync"
      pattern: "readFileSync.*data/ecosystem"
---

<objective>
Create a data loader utility that reads ecosystem JSON files at build time.

Purpose: Provide typed functions to load ecosystem entries from the file system, enabling Next.js components to access the data during static generation.

Output: A lib/ecosystem.ts module with functions to load entries by category or all at once.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-data-structure/01-01-SUMMARY.md
@lib/types/ecosystem.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ecosystem data loader</name>
  <files>lib/ecosystem.ts</files>
  <action>
Create a data loader module that reads ecosystem JSON files from the file system.

Import types from lib/types/ecosystem.ts.

Implement the following functions:

1. `getEntriesByCategory(category: CategorySlug): EcosystemEntry[]`
   - Read all .json files from data/ecosystem/{category}/
   - Parse each file and return array of EcosystemEntry
   - Use fs.readdirSync and fs.readFileSync (Node.js fs module)
   - Use path.join to construct file paths
   - Filter out non-.json files (like .gitkeep)

2. `getAllEntries(): EcosystemEntry[]`
   - Call getEntriesByCategory for each category in CATEGORIES
   - Concatenate and return all entries
   - Use the CATEGORIES constant to iterate

3. `getEcosystemByCategory(): Map<CategorySlug, EcosystemEntry[]>`
   - Return a Map with category slugs as keys and entry arrays as values
   - Useful for rendering the ecosystem grid by category

Important implementation notes:
- Use synchronous fs methods (readdirSync, readFileSync) since this runs at build time
- Use process.cwd() to get the project root, then path.join to data/ecosystem/
- Add proper TypeScript typing to all return values
- Use 'utf-8' encoding when reading files
- Parse JSON with JSON.parse()

Error handling:
- If a category directory doesn't exist, return empty array (don't throw)
- If a JSON file is malformed, log warning and skip it
  </action>
  <verify>
Create a simple test script or use Node REPL to verify:
```bash
pnpm exec tsx -e "import { getAllEntries } from './lib/ecosystem'; console.log(getAllEntries().length)"
```
Should output 12 (the number of JSON files created in Plan 01).

Also verify TypeScript compiles: `pnpm exec tsc --noEmit`
  </verify>
  <done>
lib/ecosystem.ts exports getEntriesByCategory, getAllEntries, and getEcosystemByCategory functions that successfully load and parse JSON files from data/ecosystem/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add index barrel export</name>
  <files>lib/types/index.ts</files>
  <action>
Create an index file to re-export types for cleaner imports.

Create lib/types/index.ts that re-exports everything from ecosystem.ts:

```typescript
export * from './ecosystem';
```

This allows imports like:
```typescript
import { EcosystemEntry, CategorySlug } from '@/lib/types';
```

Instead of:
```typescript
import { EcosystemEntry, CategorySlug } from '@/lib/types/ecosystem';
```
  </action>
  <verify>
Run `pnpm exec tsc --noEmit` to verify the barrel export compiles.
  </verify>
  <done>
lib/types/index.ts exists and re-exports all types from ecosystem.ts.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `pnpm exec tsc --noEmit`
2. Data loader works: `pnpm exec tsx -e "import { getAllEntries } from './lib/ecosystem'; console.log(JSON.stringify(getAllEntries()[0], null, 2))"`
3. Returns correct count: Should return 12 entries total
4. Types are importable: `pnpm exec tsx -e "import { EcosystemEntry } from './lib/types'; console.log('Types work')"`
</verification>

<success_criteria>
- lib/ecosystem.ts exports getEntriesByCategory, getAllEntries, getEcosystemByCategory
- Functions return properly typed EcosystemEntry arrays
- getAllEntries() returns 12 entries (matching JSON files from Plan 01)
- lib/types/index.ts provides barrel exports
- TypeScript compilation succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-data-structure/01-02-SUMMARY.md`
</output>
